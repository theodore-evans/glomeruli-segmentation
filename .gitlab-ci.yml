image: python:3.8

stages:
  - codecheck
  - unit_tests
  # - test_app

before_script:
  - pip install poetry
  - poetry config virtualenvs.create false

codecheck:
  stage: codecheck
  tags:
    - empaia
  variables:
  before_script:
    - poetry install
  script:
    - poetry run black --check glomeruli_segmentation
    - poetry run isort --check glomeruli_segmentation
    - poetry run pylint glomeruli_segmentation
    - poetry run black --check tests
    - poetry run isort --check tests
    - poetry run pylint tests

unit_tests:
  stage: unit_tests
  tags:
    - empaia
  before_script:
    - apt update && apt install ffmpeg libsm6 libxext6 git -y
    - poetry install
  script:
    - curl -OJ https://nx9836.your-storageshare.de/s/7FGbJRn97NYB5pD/download && mv glomeruli_segmentation_16934_best_metric.model-384e1332.pth ./tests
    - poetry run python3 -m pytest

# test_app:
#   stage: test_app
#   tags:
#     - empaia
