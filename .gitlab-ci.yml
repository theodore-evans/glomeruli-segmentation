image: python:3.8

stages:
  - codecheck
  - test

before_script:
  - python -m pip install --upgrade pip
  - pip install poetry
  - poetry config virtualenvs.create false
  - poetry install

codecheck:
  stage: codecheck
  script:
    - poetry run black --check glomeruli_segmentation
    - poetry run isort --check glomeruli_segmentation
    - poetry run pylint glomeruli_segmentation
    - poetry run black --check tests
    - poetry run isort --check tests
    - poetry run pylint tests

unit_tests:
  stage: test
  script:
    - apt update && apt install -y libgl1-mesa-dev
    - curl -OJ https://nx9836.your-storageshare.de/s/7FGbJRn97NYB5pD/download && mv glomeruli_segmentation_16934_best_metric.model-384e1332.pth ./tests
    - poetry run python3 -m pytest